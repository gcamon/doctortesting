
<!doctype html>
<!--[if lt IE 7]>       <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>          <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>          <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang=""> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Doctor Directory</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/normalize.css">
    <link rel="stylesheet" href="/assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="/assets/css/icomoon.css">
    <link rel="stylesheet" href="/assets/css/owl.theme.css">
    <link rel="stylesheet" href="/assets/css/owl.carousel.css">
    <link rel="stylesheet" href="/assets/css/prettyPhoto.css">
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/transitions.css">
    <link rel="stylesheet" href="/assets/css/color.css">
    <link rel="stylesheet" href="/assets/css/responsive.css">
    <link rel="stylesheet" href="/assets/css/angular-carousel.css">
    <style type="text/css">
    .isYou{               
        text-align: right;
        padding: 5px 15px;  
    }
    .chatPallet {
        padding: 5px 15px;
        margin: 0px 2px;
        border-radius: 10px;  
    }

    article {
        color: #000;
        padding: 3px 10px;
        display: inline-block;
        background-color: #bbd670;
        border-radius: 4px;
        box-shadow: 0px 1px 1px rgba(0,0,0,0.3);

    }
    </style>

    <!--<script src="/assets/js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>-->
</head>
<body ng-app = "myApp">
        <!--[if lt IE 8]>
                <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
        <!--************************************
                        Wrapper Start
        *************************************-->
        
            <!--************************************
                            Header Start
            *************************************-->
           
        <!--************************************
                Header End
        *************************************-->
        <!--************************************
                Home Slider Start
        *************************************-->
       
        <!--************************************              
                            <div ng-view class="view-animate">
                            </div>
                        </div>          
                Home Slider End
        *************************************-->
        <!--************************************
                Main Start
        *************************************-->
        <main id="main" class="tg-main-section tg-haslayout" ng-controller="joinRoomController2">
            <div class="pure-u-2-3" id="video-container" style="width: 800px;height:800px;margin:0 auto">
                <div style="position:relative">
                    <video id="their-video" autoplay style="width: 100%; height: 100%; background-color: #000"></video>
                    <video id="my-video" muted="true" autoplay style="width: 140px; height:140px; position: absolute; right:1px;top:-14px"></video>
                </div>
                <div id="step1">
                  
                  <div id="step1-error">                                           
                    <a href="#" class="pure-button pure-button-error" id="step1-retry">Try again</a>
                   </div>
                </div>
               <!-- Make calls to others -->
                <div id="step2">
                    <button class="pure-button pure-button-success" id="make-call" style="background-color:#7dbb00;color:#fff;padding:10px 30px; font-size: 18px">
                        <i class="fa fa-phone" style="color:#fff;padding-right: 8px"></i>Call</button>
                  <p>Your id: <span id="my-id">...</span></p>
                  <p>Share this id with others so they can call you.</p>
                  <h3>Make a call</h3>
                  <div class="pure-form">
                    <input type="text" placeholder="Call user id..." id="callto-id">
                    
                  </div>
            </div>

            <div class="container-fluid">
                <button ng-click="sendCommunictionRequest()">Send request</button>
                 <button ng-click="send()">Send test for prescription</button>
                 <button ng-click="sendRequest()">Send consultation request</button>
                 <button ng-click="logout()">disconnect</button>
                 <button ng-click="login()">connect</button>
                <div class="row">
                    <div class="col-lg-9 col-md-9 col-sm-8 col-xs-12 pull-right">
                        <div class="row">
                            <div class="col-sm-12 col-md-9 col-lg-9">                                
                                <ul style='list-style:none;margin-top: 40px'>
                            <li ng-repeat="u in message1">
                                <div ng-if="u.sent" ng-class="{'isYou' : u.sent}">
                                    <!--<p style="text-align:center"> &nbsp;{{u.time | date: "shortTime"}} &nbsp;{{u.time | date: "mediumDate"}}</p> -->  
                                    <article style="text-align:right;background-color:#d2ed88" class="chat">
                                        <span>{{u.sent}}</span>
                                        <small style="font-size:9px;font-style:italic"> &nbsp;{{u.time | date: "shortTime"}}</small>
                                        <i class="fa fa-check" style="font-size:10px" ng-class="{'msg-received': u.isReceived === true}"></i>
                                        <i class="fa fa-check" style="font-size:10px;margin-left:-10px;margin-top:8px" ng-class="{'msg-received': u.isReceived === true}" ng-if="u.isSent === true"></i>       
                                    </article>
                                </div>
                                <div ng-if="u.received" class="chatPallet">                                                         
                                    <article class="chat">
                                        <span>{{u.received}}</span>
                                        <small style="font-size:9px;font-style:italic"> &nbsp;{{u.time | date: "shortTime"}}</small>    
                                    </article>                                               
                                </div>                                  
                            </li>
                            <li><article style="margin-left: 18px;margin-top:5px;color:rgba(0,0,0,0.4);font-style:italic;box-shadow: 0px 1px 2px rgba(0,0,0,0.5);background-color:#eee" ng-if="typing" class="chat">{{typing}}</article></li>
                                                      
                        </ul>                         
                                  
                                <div>
                                    <article style="background-color: #fff">{{typing}}</article>                              
                                    <input type="text" placeholder="Write..." ng-model="user.text2">
                                    <button ng-click="sendChat2()">send</button>
                                </div> 
                            </div>
                            <!--<my-iframe ng-src="{{link}}" height= "800" width="800">-->
                            
                            <!--<div class="col-sm-3 col-md-3 col-lg-3">
                            </div>-->
                        </div>
                    </div>
                    
                   
                </div>
            </div><!-- main content -->
           
        </main>
        <!--************************************
                Main End
        *************************************-->
        <!--************************************
                Footer Start
        *************************************-->
        
        <!--************************************
                Footer End
        *************************************-->
    
    <!--************************************
            Wrapper End
    *************************************-->
    <!--************************************
        Sign In Sign Up Light Box Start
    *************************************-->
       
        
    
   
     
    
     

    

    <!--************************************
        Sign In Sign Up Light Box End
    *************************************-->
        <!--<script src="https://media.twiliocdn.com/sdk/js/common/v0.1/twilio-common.min.js"></script>        
        <script src="https://media.twiliocdn.com/sdk/js/video/releases/1.0.0-beta2/twilio-video.js"></script>
        <script src="https://media.twiliocdn.com/sdk/rtc/js/ip-messaging/v0.10/twilio-ip-messaging.min.js"></script>-->
        
        <script src="/assets/js/vendor/jquery-library.js"></script>
        <script src="/assets/js/vendor/bootstrap.min.js"></script>
        <script type="text/javascript" src="/assets/js/source.js"></script>
        <script type="text/javascript" src="/assets/js/angularclient.js"></script>
        <script type="text/javascript" src="/assets/js/ngroute.js"></script>
        <script src="/socket.io/socket.io.js"></script>   
        <script src="/assets/js/angular-socket-io-master/socket.min.js"></script>
        <script src="/assets/js/jquery-ui.js"></script>
        <script src="http://maps.google.com/maps/api/js?sensor=false"></script>
        <script src="/assets/js/map/jquery.gomap.js"></script>
        <script src="/assets/js/map/markerclusterer.min.js"></script>
        <script src="/assets/js/countdown.js"></script>
        <script src="/assets/js/jquery.nicescroll.js"></script>
        <script type="text/javascript">
            $(document).ready(function(){
                $("#drp-of-msg").niceScroll({cursorcolor:"#ccc",cursorwidth:"5px"});
                $("#my-doctors-list").niceScroll({cursorcolor:"#ccc",cursorwidth:"5px"});
                $("#noti-drp-list").niceScroll({cursorcolor:"#ccc",cursorwidth:"5px"});
                $(".view-animate-container").niceScroll({cursorcolor:"#ccc",cursorwidth:"3px"});
            })
        </script>
        <!--<script src="/assets/js/main.js"></script>-->
        <script src="http://cdn.peerjs.com/0.3/peer.js"></script>s
        <script src="/assets/js/parallax.js"></script>
        <script src="/assets/js/owl.carousel.js"></script>
        <script src="/assets/js/prettyPhoto.js"></script>
        <script src="/assets/js/appear.js"></script>
        <script src="/assets/js/countTo.js"></script>
        <script src="/assets/js/map/map.js"></script>
        <script src="/assets/js/angularAnimate.js"></script>
        <script src="/assets/js/modalService.js"></script>
        <script src="/assets/js/angular-touch.min.js"></script>
        <script src="/assets/js/angular-carousel.js"></script>
        <script src="/assets/js/moment.min.js"></script>
        <script src="/assets/js/angular-moment.min.js"></script>
        <script src="/assets/js/ui-bootstrap-tpls.js"></script>
        <script src="/assets/js/angular-clipboard.js"></script>
        <script src="/assets/js/ngresource.js"></script>
   <!--<script src="http://angular-ui.github.com/bootstrap/ui-bootstrap-tpls-0.2.0.js"></script>-->

       <!--<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">-->
        <script type="text/javascript">    
        
   navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
   var receiverRaw = localStorage.getItem("receiver");
   var callerRaw = localStorage.getItem("caller");
   var receiver = JSON.parse(receiverRaw);
   var caller = JSON.parse(callerRaw);
   console.log(receiver);
   console.log(caller);
   
    // PeerJS object
   
    var peer = new Peer(caller,{key: "pciwsjsoykb21emi"});
    
    peer.on('open', function(){
        console.log(peer)
      $('#my-id').text(peer.id);
    });

    // Receiving a call
    peer.on('call', function(call){
      // Answer the call automatically (instead of prompting user) for demo purposes
      audio();
      call.answer(window.localStream);
      $('#answer-btn').click(function(){       
      });   
      step3(call);
    });

    peer.on('error', function(err){
      alert(err.message);
      // Return to step 2 if error occurs
      step2();
    });

    // Click handlers setup
    window.addEventListener('load',function(){
        console.log("calling")
      $('#make-call').click(function(){
        // Initiate a call!
        var call = peer.call(receiver, window.localStream);
        step3(call);
      });
      $('#end-call').click(function(){
        window.existingCall.close();
        step2();
      });
      // Retry if getUserMedia fails
      $('#step1-retry').click(function(){
        $('#step1-error').hide();
        step1();
      });
      // Get things started
         step1();
     
    });
    function step1 () {
      // Get audio/video stream
      navigator.getUserMedia({audio: true, video: true}, function(stream){
        // Set your video displays
        $('#my-video').prop('src', URL.createObjectURL(stream));
        window.localStream = stream;
        step2();
      }, function(){ $('#step1-error').show(); });
    }
    function step2 () {
      $('#step1, #step3').hide();
      $('#step2').show();
    }
    function step3 (call) {
      // Hang up on an existing call if present
      if (window.existingCall) {
        window.existingCall.close();
      }
      // Wait for stream on the call, then set peer video display
      call.on('stream', function(stream){
        $('#their-video').prop('src', URL.createObjectURL(stream));
      });
      // UI stuff
      window.existingCall = call;
      $('#their-id').text(call.peer);
      call.on('close', step2);
      $('#step1, #step2').hide();
      $('#step3').show();
    }
    
    
    var audio = function(){
        var audio = new Audio('/assets/audio/gets-in-the-way.mp3');
        audio.play();
        $('#answer-btn').show();
    }

        </script>

</body>
</html>